' CSUB demo of Barnsley's Fern
' Author: Sasquatch
'
' Renders ~150X faster than pure MMBasic version
' This demo will render continuously until Q)uit

#Include "../common/welcome.inc"

Mode 1,8

init_screen()

Zoom = 1.0
Seed% = &hAAAAAAAA

Do While Inkey$ <> "" : Loop ' clear keyboard buffer

Do
 Fern(40000,Zoom,Seed%)
 K$ = LCase$(Inkey$)
 If K$ <> "" Then
   If K$ = "i" Then Zoom = Zoom * 2 : init_screen()
   If K$ = "o" Then Zoom = Zoom / 2 : init_screen()
   If K$ = "q" Then Exit Do
 EndIf
Loop

we.quit% = 1
we.end_program()

Sub init_screen()
  Cls

  Text 0, 0, "Barnsley's Fern using CSUB", "", 2
  Text 2, 25, "Press 'I' to Zoom in", "", 1
  Text 2, 40, "Press 'O' to Zoom out", "", 1
  Text 2, 55, "Press 'Q' to Quit", "", 1

  'Draw a white pixel in the cente of the screen
  Pixel 400,300,RGB(white)
End Sub

' CSUB version of Barnsley's Fern
'
' Fern(Iterations%,Zoom!,Seed%)
'
' Note that this Sub stores it's state in Seed and can be called repeatedly -
'   it will continue to render as long as the Seed is not the same on each call.
' Caution:  I have found that calling for more than 40,000 iterations -
'   can interfere with MMBasic background functions such as reading keyboard
' Higher Zoom factor will take some time to render
' File fern.bas written 10-08-2020 13:11:17
CSUB fern
 00000000
 'Fern
 B098B580 60F8AF00 607A60B9 E9D368FB 46132300 68BB627B 2300E9D3 2306E9C7
 0200F04F E9C74BA6 F04F2310 4BA40200 230EE9C7 681B687B 687B65BB 657B681B
 681B687B 687B653B 64FB681B 65FB2300 6CFBE0E3 6DBB617B 6D3B613B 6D7B64FB
 693B653B 697B657B 697A02DB 617B4053 0A1B697B 4053697A 697A617B 405A6DBB
 0CDB6DBB 65BB4053 4A8E6DBB D3244293 7B10ED97 6B68ED9F 6B06EE27 7B0EED97
 5B67ED9F 7B05EE27 7B07EE36 7B0CED87 7B10ED97 6B64ED9F 6B06EE27 7B0EED97
 5B5DED9F 7B05EE27 7B07EE36 6B60ED9F 7B06EE37 7B0AED87 6DBBE067 42934A7A
 6DBBD928 42934A77 ED97D224 ED9F7B10 EE276B5A ED976B06 ED9F7B0E EE275B59
 EE367B05 ED877B07 ED977B0C ED9F7B10 EE276B56 ED976B06 ED9F7B0E EE275B55
 EE367B05 ED9F7B07 EE376B54 ED877B06 E03A7B0A 4A656DBB D9284293 4A626DBB
 D8244293 7B10ED97 6B4DED9F 6B06EE27 7B0EED97 5B44ED9F 7B05EE27 7B47EE36
 7B0CED87 7B10ED97 6B47ED9F 6B06EE27 7B0EED97 5B46ED9F 7B05EE27 7B07EE36
 6B33ED9F 7B06EE37 7B0AED87 F04FE00D F04F0200 E9C70300 ED97230C ED9F7B0E
 EE276B3E ED877B06 E9D77B0A E9C7230C E9D72310 E9C7230A 4B45230E ED97681B
 ED9F7B10 EE276B37 ED976B06 EE267B06 ED9F7B07 EE376B35 EEFD7B06 ED975BC7
 EEB17B0E EE376B04 ED9F7B46 EE276B31 ED976B06 EE267B06 ED9F7B07 EE366B2F
 EEFD7B47 F44F7BC7 EE1742C8 EE151A90 47980A90 33016DFB 6DFA65FB 429A6A7B
 AF17F6FF 687B6DBA BF00601A 46BD3760 BF00BD80 8000F3AF 33333333 3FEB3333
 47AE147B 3FA47AE1 47AE147B BFA47AE1 9999999A 3FF99999 33333333 BFC33333
 1EB851EC 3FD1EB85 0A3D70A4 3FD0A3D7 EB851EB8 3FCEB851 C28F5C29 3FDC28F5
 9999999A 3FC99999 D70A3D71 3FCD70A3 C28F5C29 3FCC28F5 47AE147B 3FC47AE1
 00000000 40590000 00000000 40790000 00000000 40490000 00000000 4072C000
 3FF00000 26666666 147AE147 028F5C28 08000338
End CSUB
